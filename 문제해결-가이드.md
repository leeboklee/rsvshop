# RSVShop 문제 해결 가이드

## 🚨 긴급 상황 - 서버가 안 될 때

### 1. 자동 복구 실행 (권장)
```bash
# Linux/WSL
npm run fix:all          # 전체 자동 복구
npm run fix:db           # 데이터베이스만 복구
npm run start:safe       # 안전한 서버 시작

# Windows
auto-fix.bat
```

### 2. 수동 복구 단계별 가이드

#### Step 1: PostgreSQL 확인 및 시작
```bash
sudo service postgresql status
sudo service postgresql start
```

#### Step 2: 포트 4900 확인
```bash
ss -tlnp | grep 4900
```

#### Step 3: 서버 시작
```bash
npm run dev:simple
```

## 🔧 일반적인 문제들

### 1. 포트 4900 충돌 (EADDRINUSE)
**증상**: `Error: listen EADDRINUSE: address already in use :::4900`

**해결 방법**:
```bash
# 포트 사용 중인 프로세스 확인
ss -tlnp | grep 4900

# 프로세스 종료 (PID는 위 명령어로 확인)
kill -9 [PID]

# 서버 재시작
npm run dev:simple
```

### 2. 데이터베이스 연결 실패
**증상**: `Can't reach database server at 127.0.0.1:5432`

**해결 방법**:
```bash
# PostgreSQL 상태 확인
sudo service postgresql status

# PostgreSQL 시작
sudo service postgresql start

# 데이터베이스 연결 테스트
npx prisma db push
```

### 3. Next.js 설정 오류
**증상**: `Invalid next.config.js options detected`

**해결 방법**:
```bash
# next.config.js 수정 후
npx next dev --port 4900
```

### 4. 메모리 부족 오류
**증상**: `JavaScript heap out of memory`

**해결 방법**:
```bash
# 메모리 제한 증가하여 시작
NODE_OPTIONS='--max-old-space-size=4096' npm run dev:simple
```

### 5. Windows-WSL 환경 문제
**증상**: 
- WSL 재시작 시 PostgreSQL 자동 시작 안됨
- Windows 시작 시 RSVShop 자동 시작 안됨
- WSL과 Windows 간 포트 접근 문제

**해결 방법**:
```batch
# Windows 시작 시 자동 실행 설정
setup-windows-autostart.bat

# WSL 환경에서 PostgreSQL 자동 시작 설정
bash ./scripts/setup-auto-start.sh

# Windows에서 수동으로 RSVShop 시작
start-rsvshop-windows.bat
```

## 🚀 서버 시작 방법들

### 기본 시작
```bash
npm run dev:simple
```

### 메모리 최적화 시작
```bash
npm run dev:optimized
```

### 백그라운드 시작
```bash
npm run dev:bg
```

### PM2로 시작
```bash
npm run dev:pm2
```

## 📊 상태 확인 명령어

### 서버 상태
```bash
# 포트 확인
ss -tlnp | grep 4900

# 프로세스 확인
ps aux | grep next
```

### 데이터베이스 상태
```bash
# PostgreSQL 상태
sudo service postgresql status

# 연결 테스트
npx prisma db push
```

### 로그 확인
```bash
# 서버 로그
tail -f dev-server.log

# PM2 로그
npm run dev:pm2:logs
```

## 🆘 문제가 지속될 때

### 1. 완전 초기화
```bash
# 캐시 삭제
npm run clean

# node_modules 재설치
rm -rf node_modules package-lock.json
npm install

# 데이터베이스 재생성
npx prisma migrate reset --accept-data-loss
```

### 2. 시스템 재시작
```bash
# WSL 재시작
wsl --shutdown
# Windows에서 WSL 다시 시작

# 또는
sudo reboot
```

### 3. 포트 변경
```bash
# 다른 포트로 시작
npx next dev --port 4901
```

## 📞 지원

문제가 해결되지 않으면:
1. `dev-server.log` 파일 확인
2. 터미널 오류 메시지 복사
3. 개발팀에 문의

## 🔄 예방 방법

### 1. 자동 시작 설정 (1회 설정)

#### Linux/WSL 환경
```bash
# 자동 시작 설정 (WSL 시작 시 자동으로 PostgreSQL 시작)
bash ./scripts/setup-auto-start.sh
```

#### Windows 환경
```batch
# Windows 시작 시 자동 실행 설정 (관리자 권한 필요)
setup-windows-autostart.bat

# 수동 실행
start-rsvshop-windows.bat
```

### 2. 정기 점검
```bash
# 매일 한 번 실행
npm run fix:all

# 또는 cron으로 자동 실행 (setup-auto-start.sh에서 설정)
```

### 2. 모니터링 설정
```bash
# PM2 모니터링 활성화
npm run dev:pm2
pm2 monit
```

### 3. 자동 백업
```bash
# 데이터베이스 자동 백업
npm run db:backup
```

---

**마지막 업데이트**: 2025년 8월 30일
**버전**: 1.0.0
